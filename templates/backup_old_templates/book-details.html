<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–ª–∏ –∫–Ω–∏–≥–∏ - –û–Ω–ª–∞–π–Ω –ö—ñ—Ç–∞–ø—Ö–∞–Ω–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .back-link {
            display: inline-block;
            margin-bottom: 30px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .book-header {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .book-cover-large {
            width: 100%;
            height: 450px;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .book-cover-placeholder {
            width: 100%;
            height: 450px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .book-info h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 15px;
        }

        .book-author {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .book-meta {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .meta-item {
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .meta-label {
            font-weight: bold;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .meta-value {
            color: #333;
            font-size: 16px;
        }

        .book-description {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .book-description h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .book-description p {
            color: #555;
            line-height: 1.8;
            font-size: 16px;
        }

        .subjects {
            margin-top: 30px;
        }

        .subjects h2 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .subject-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .subject-tag {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border-radius: 20px;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 20px;
            color: #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/books" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–Ω–∏–≥–∞–º / –ö—ñ—Ç–∞–ø—Ç–∞—Ä“ì–∞ –æ—Ä–∞–ª—É</a>
        
        <div id="bookContent">
            <div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–Ω–∏–≥–µ... / –ö—ñ—Ç–∞–ø —Ç—É—Ä–∞–ª—ã –∞“õ–ø–∞—Ä–∞—Ç –∂“Ø–∫—Ç–µ–ª—É–¥–µ...</div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º ID –∫–Ω–∏–≥–∏ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const bookKey = urlParams.get('key');

        if (!bookKey) {
            document.getElementById('bookContent').innerHTML = 
                '<div class="loading">‚ùå –ö–Ω–∏–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ / –ö—ñ—Ç–∞–ø —Ç–∞–±—ã–ª–º–∞–¥—ã</div>';
        } else {
            loadBookDetails(bookKey);
        }

        async function loadBookDetails(key) {
            try {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ –∏–∑ Open Library API
                const response = await fetch(`https://openlibrary.org${key}.json`);
                const book = await response.json();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–∞—Ö
                let authors = '–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
                if (book.authors && book.authors.length > 0) {
                    try {
                        const authorPromises = book.authors.map(author => {
                            const authorKey = author.author ? author.author.key : author.key;
                            return fetch(`https://openlibrary.org${authorKey}.json`)
                                .then(r => r.json())
                                .catch(() => ({name: '–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω'}));
                        });
                        const authorData = await Promise.all(authorPromises);
                        authors = authorData.map(a => a.name).filter(n => n).join(', ');
                    } catch (e) {
                        console.error('Author load error:', e);
                    }
                }

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL –æ–±–ª–æ–∂–∫–∏
                let coverUrl = null;
                if (book.covers && book.covers.length > 0) {
                    coverUrl = `https://covers.openlibrary.org/b/id/${book.covers[0]}-L.jpg`;
                }

                // –ü–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
                let description = '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç / –°–∏–ø–∞—Ç—Ç–∞–º–∞ –∂–æ“õ';
                if (book.description) {
                    description = typeof book.description === 'string' 
                        ? book.description 
                        : book.description.value;
                }

                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–Ω–∏–≥—É
                displayBook(book, authors, coverUrl, description);

            } catch (error) {
                console.error('Error loading book:', error);
                document.getElementById('bookContent').innerHTML = 
                    '<div class="loading">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + ' / –ñ“Ø–∫—Ç–µ—É “õ–∞—Ç–µ—Å—ñ</div>';
            }
        }

        function displayBook(book, authors, coverUrl, description) {
            // –î–ª—è works –∏—Å–ø–æ–ª—å–∑—É–µ–º first_publish_year
            const publishYear = book.first_publish_year || book.publish_date || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            
            const content = `
                <div class="book-header">
                    <div>
                        ${coverUrl 
                            ? `<img src="${coverUrl}" alt="${book.title}" class="book-cover-large" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                               <div class="book-cover-placeholder" style="display:none;">üìñ</div>` 
                            : '<div class="book-cover-placeholder">üìñ</div>'
                        }
                    </div>
                    <div class="book-info">
                        <h1>${book.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</h1>
                        <div class="book-author">‚úçÔ∏è ${authors}</div>
                        
                        <div class="book-meta">
                            <div class="meta-item">
                                <div class="meta-label">–ì–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ / –ñ–∞—Ä–∏—è–ª–∞–Ω“ì–∞–Ω –∂—ã–ª—ã</div>
                                <div class="meta-value">${publishYear}</div>
                            </div>
                            
                            ${book.subject_places && book.subject_places.length > 0 ? `
                                <div class="meta-item">
                                    <div class="meta-label">–ú–µ—Å—Ç–æ / –û—Ä—ã–Ω</div>
                                    <div class="meta-value">${book.subject_places.slice(0, 3).join(', ')}</div>
                                </div>
                            ` : ''}
                            
                            ${book.subject_times && book.subject_times.length > 0 ? `
                                <div class="meta-item">
                                    <div class="meta-label">–í—Ä–µ–º—è / –£–∞“õ—ã—Ç</div>
                                    <div class="meta-value">${book.subject_times.slice(0, 3).join(', ')}</div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="alert('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ / –§—É–Ω–∫—Ü–∏—è ”ô–∑—ñ—Ä–ª–µ–Ω—É–¥–µ')">
                                üìö –î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É / –ö—ñ—Ç–∞–ø—Ö–∞–Ω–∞“ì–∞ “õ–æ—Å—É
                            </button>
                            <a href="https://openlibrary.org${book.key}" target="_blank" class="btn btn-secondary">
                                üîó –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ OpenLibrary
                            </a>
                        </div>
                    </div>
                </div>
                
                ${description !== '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç / –°–∏–ø–∞—Ç—Ç–∞–º–∞ –∂–æ“õ' ? `
                    <div class="book-description">
                        <h2>üìñ –û–ø–∏—Å–∞–Ω–∏–µ / –°–∏–ø–∞—Ç—Ç–∞–º–∞</h2>
                        <p>${description}</p>
                    </div>
                ` : ''}
                
                ${book.subjects && book.subjects.length > 0 ? `
                    <div class="subjects">
                        <h2>üè∑Ô∏è –¢–µ–º—ã / –¢–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä</h2>
                        <div class="subject-tags">
                            ${book.subjects.slice(0, 15).map(subject => 
                                `<span class="subject-tag">${subject}</span>`
                            ).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('bookContent').innerHTML = content;
        }
    </script>
</body>
</html>
